<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŒ¿ Plant Care</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#eef4f1;
  --card:rgba(255,255,255,.92);
  --accent:#4caf87;
  --accent-dark:#3e8c70;
  --text:#2b3a33;
  --warn:#e6a23c;
  --danger:#e94f4f;
  --shadow:0 10px 30px rgba(0,0,0,.08);
}
*{box-sizing:border-box;font-family:'Montserrat',sans-serif}
body{margin:0;background:var(--bg);padding:1rem;color:var(--text)}
h1{text-align:center;color:var(--accent);margin:.5rem 0 1rem}

.card{background:var(--card);border-radius:22px;box-shadow:var(--shadow);padding:1rem;margin-bottom:1rem;backdrop-filter:blur(8px)}
input,textarea,button,select{
  width:100%;padding:.75rem;border-radius:14px;border:1px solid #ccc;margin-bottom:.6rem;font-size:1rem
}
button{background:var(--accent);color:#fff;font-weight:600;border:none}
button:hover{background:var(--accent-dark)}
.small{font-size:.8rem;opacity:.7}

.plants{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem}
.plant img{width:100%;border-radius:16px;margin-bottom:.4rem}
.plant{transition:transform .2s}
.plant:hover{transform:translateY(-4px)}

.status.warn{color:var(--warn);font-weight:600}
.status.danger{color:var(--danger);font-weight:600}

.actions{display:flex;gap:.4rem}
.actions button{flex:1}

.toast{
  position:fixed;bottom:25px;left:50%;transform:translateX(-50%) translateY(20px);
  background:white;border-radius:999px;padding:1rem 1.4rem;
  box-shadow:0 12px 30px rgba(0,0,0,.15);
  opacity:0;pointer-events:none;transition:.4s;font-weight:600
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

.ring{
  width:140px;height:140px;border-radius:50%;
  background:conic-gradient(var(--accent) calc(var(--p)*1%), #ddd 0);
  display:flex;align-items:center;justify-content:center;margin:auto
}
.ring span{
  background:white;width:100px;height:100px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;font-weight:700
}
</style>
</head>

<body>

<h1>ðŸŒ¿ Plant Care</h1>

<div class="card" style="text-align:center">
  <div class="ring" id="ring" style="--p:0"><span id="score">â€”</span></div>
  <div class="small" id="scoreText">Last 30 days</div>
</div>

<div class="card">
<form id="form">
  <input id="name" placeholder="Plant name" required>

  <input type="number" id="waterInterval" placeholder="Water every X days" required>
  <input type="date" id="lastWatered">

  <input type="number" id="repotInterval" placeholder="Repot every X days">
  <input type="date" id="lastRepotted">

  <input type="number" id="fertInterval" placeholder="Fertilize every X days">
  <input type="date" id="lastFertilized">

  <input type="file" id="image" accept="image/*">
  <button>Add Plant ðŸŒ±</button>
</form>
</div>

<div class="plants" id="plants"></div>
<div class="toast" id="toast"></div>

<script>
const $=id=>document.getElementById(id)
let plants=JSON.parse(localStorage.getItem("plants")||"[]")
let log=JSON.parse(localStorage.getItem("log")||"[]")
let lastMsg=localStorage.getItem("lastMsg")||""

const msgs=[
"Small care adds up ðŸŒ±","Youâ€™re doing great","Plants notice effort",
"Quiet progress counts","Go on. GIT â€” From Ryan",
"Youâ€™re amazing â€” From Ryan","This plant loves you",
"You complete me â€” From Ryan"
]

function save(){
  localStorage.setItem("plants",JSON.stringify(plants))
  localStorage.setItem("log",JSON.stringify(log))
}

function days(a,b){return Math.floor((b-a)/86400000)}

function toast(msg){
  const t=$("toast")
  t.textContent=msg
  t.classList.add("show")
  setTimeout(()=>t.classList.remove("show"),3500)
}

function maybeMsg(){
  const today=new Date().toDateString()
  if(today===lastMsg)return
  lastMsg=today
  localStorage.setItem("lastMsg",today)
  toast(msgs[Math.floor(Math.random()*msgs.length)])
}

function score(){
  const cutoff=Date.now()-30*86400000
  const recent=log.filter(l=>l.t>cutoff)
  if(!recent.length)return null
  return Math.round(100*recent.filter(l=>l.ok).length/recent.length)
}

function renderScore(){
  const s=score()
  $("ring").style="--p:"+(s||0)
  $("score").textContent=s?s+"%":"â€”"
}

function addCalendar(p,type){
  const map={
    water:["ðŸ’§ Water","waterInterval","lastWatered"],
    repot:["ðŸª´ Repot","repotInterval","lastRepotted"],
    fert:["ðŸŒ± Fertilize","fertInterval","lastFertilized"]
  }
  const [title,intKey,lastKey]=map[type]
  if(!p[intKey])return

  const start=new Date(p[lastKey]).toISOString().split("T")[0].replace(/-/g,"")
  const ics=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${title} ${p.name}
DTSTART:${start}
RRULE:FREQ=DAILY;INTERVAL=${p[intKey]}
END:VEVENT
END:VCALENDAR`

  const blob=new Blob([ics],{type:"text/calendar"})
  const a=document.createElement("a")
  a.href=URL.createObjectURL(blob)
  a.download=`${p.name}-${type}.ics`
  a.click()
}

function render(){
  renderScore()
  $("plants").innerHTML=""
  plants.forEach(p=>{
    const now=Date.now()
    const w=days(p.lastWatered,now)-p.waterInterval
    const r=days(p.lastRepotted,now)-(p.repotInterval||99999)
    const f=days(p.lastFertilized,now)-(p.fertInterval||99999)

    $("plants").innerHTML+=`
    <div class="card plant">
      ${p.image?`<img src="${p.image}">`:""}
      <strong>${p.name}</strong>
      <div class="status ${w>0?'danger':w>-2?'warn':''}">ðŸ’§ ${w>0?'Overdue':Math.abs(w)} days</div>
      ${p.repotInterval?`<div class="status ${r>0?'warn':''}">ðŸª´ Repot ${r>0?'due':''}</div>`:""}
      ${p.fertInterval?`<div class="status ${f>0?'warn':''}">ðŸŒ± Fertilize ${f>0?'due':''}</div>`:""}

      <textarea oninput="p.notes=this.value;save()">${p.notes||""}</textarea>

      <div class="actions">
        <button onclick="p.lastWatered=Date.now();log.push({t:Date.now(),ok:true});save();maybeMsg();render()">ðŸ’§</button>
        <button onclick="addCalendar(p,'water')">ðŸ“…</button>
      </div>
    </div>`
  })
}

$("form").onsubmit=async e=>{
  e.preventDefault()
  let img=""
  if(image.files[0]){
    img=await new Promise(r=>{
      const f=new FileReader()
      f.onload=()=>r(f.result)
      f.readAsDataURL(image.files[0])
    })
  }
  plants.push({
    id:crypto.randomUUID(),
    name:name.value,
    waterInterval:+waterInterval.value,
    repotInterval:+repotInterval.value||null,
    fertInterval:+fertInterval.value||null,
    lastWatered:new Date(lastWatered.value||Date.now()).getTime(),
    lastRepotted:new Date(lastRepotted.value||Date.now()).getTime(),
    lastFertilized:new Date(lastFertilized.value||Date.now()).getTime(),
    image:img,notes:""
  })
  save();render();e.target.reset()
}

render()
</script>
</body>
</html>
